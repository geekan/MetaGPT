#                                   智能写作

+ 技术沉淀：

  参考博客： [智能写作](https://blog.csdn.net/weixin_43214046/article/details/140763218)    [metagpt 源码解读](https://blog.csdn.net/weixin_43214046/article/details/140042393)   [llama-index 检索](https://blog.csdn.net/weixin_43214046/article/details/140718306)


+ **设计思路：**

  `ai_writer`的设计灵感源自`data_interpreter`，其目标是将编程任务解决策略的成功经验拓展至文档撰写领域。

  在`data_interpreter`中，我们首先将用户的原始问题分解为多个具体的子任务，并由人类专家对这些子任务进行初步审查；接着，按照既定顺序执行这些子任务，对每个子任务进行编码、运行代码，并保存执行过程中的关键中间变量。

  在`ai_writer`中，我借鉴了这一方法，首先结合用户需求与上传的文件，将内容细化为详细的大纲，例如：设置二级标题等。人类专家对模型生成的大纲标题进行审阅和修订。随后，按照大纲的编排顺序，针对每个子标题，结合相关检索信息，进行段落撰写。

  撰写方式分为并行撰写和顺序撰写两种。并行撰写指的是章节间或段落间相互独立，而顺序撰写则需考虑前文内容，需要一个较长的上下文窗口。此外，我们采用长期记忆机制，将每个章节生成的段落依次纳入检索库，以便后续章节的检索。

  在人类写作模式中，可以将大纲视为`write_tree`。`ai_writer`负责对叶节点的标题进行“写段落”操作，对内节点进行“写指南”操作。指南的作用在于承上启下，为未来版本中的功能优化打下基础。在未来的版本中，撰写指南是根据当前标题的信息，让模型输出当前写作段落的具体指令信息。这些指令将限定模型的输出范围，确保内容深度和针对性。

+ **遗留问题**：
  1.  采用`chat-model` ，由于输出文本长度有限，需要划分更细粒度的标题(4级标题)，导致模型生成段落之间存在冗余现象；
  2. 目前采用`LLama-index` 检索框架，标题信息有限，检索精度不高。
  3. 目前将表格， 公式 ，图片均已 `markdown` 形式表达，在生成段落里插图、插表缺乏依据。  

+ **演示：**

  **以论文写作为例：**

  https://github.com/user-attachments/assets/8aff7a46-1d66-473c-9346-669c6ab1a02a

  界面主要有**开始、大纲、生成段落、功能区**等组件完成；

  **开始：** 输入用户需求和上传相关待检索文件；

  **大纲**：根据写作需求生成写作大纲，`json` 字段表示，点击**确认**， 转化`write_tree`对象，并全局保存； 

  **生成段落**：输入当前`chapter_id` 章节序号，从上传文件里，检索该章节相关的文本块，生成指南、生成段落；

  **功能区** ： 根据 当前`chapter_id` 章节序号， 输入润色指令进行润色；**联网：**从网络上获取当前当前标题相关网络信息; 





​              

​             

































.
